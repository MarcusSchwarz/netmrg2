{{>settingsheader}}
            <h1 class="page-header">Settings - SQL</h1>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th class="nowrap">[<span id="selectall" class="glyphicon glyphicon-asterisk" title="select all"></span>] [<span id="selectnothing" class="glyphicon glyphicon-unchecked" title="select nothing"></span>] [<span id="selectinvert" class="glyphicon glyphicon-minus" title="invert selection"></span>]</th>
                <th>Name</th>
                <th>Host</th>
                <th>User</th>
                <th>Query</th>
                <th class="text-right"><a href="{{#route}}/settings/sql/add{{/route}}">add</a></th>
            </tr>
        </thead>
        <tbody>
        {{#sql}}
            <tr>
                <td>
                    <input class="netmrg-check-sql" type="checkbox" name="checkboxes[]" value="{{id}}" data-csrftoken="{{csrftoken}}">
                </td>
                <td>
                    {{name}}
                </td>
                <td>
                    {{host}}
                </td>
                <td>
                    {{user}}
                </td>
                <td title="{{fullquery}}" style="cursor: help;">
                    {{query}}
                </td>
                <td class="text-right nowrap">
                    <a href="{{#route}}/settings/sql/edit?id={{id}}{{/route}}" style="margin-right:10px;"><span class="glyphicon glyphicon-pencil" title="edit sql"></span></a>
                    <a href="{{#route}}/settings/sql/delete?id={{id}}{{/route}}" data-csrftoken="{{csrftoken}}" data-confirmButton="Yes, delete" data-cancelButton="no" data-text="Do you really want to delete <strong>{{fullquery}}</strong>?" data-okButtonClass="btn-danger" class="confirm"><span class="glyphicon glyphicon-remove alert-danger" title="delete sql"></span></a>
                </td>
            </tr>
        {{/sql}}
        </tbody>
    </table>
    {{sumsql}} SQL Statements
    <hr style="border-bottom: 1px solid #EEE;">
    <a id="batchdelete" href="{{#route}}/settings/sql/delete{{/route}}">Batch delete selected SQL Statements</a>
</div>

<script>
    $(".confirm").confirm({
        title: 'Confirmation',
        confirmButtonClass: 'btn-danger',
        post: true
    });

    $("#batchdelete").confirm({
        title: 'Confirmation',
        confirm: function() {
            var delids = $('.netmrg-check-sql').map(
                    function(k, v) {
                        if($(v).prop('checked')) {
                            return $(v).prop('value');
                        }
                    }
            );
            if(delids.length < 1) {
                alert('nothing selected');
                return false;
            }
            var form = $('<form method="post" class="hide" action="{{#route}}/settings/sql/delete{{/route}}"></form>');
            var z = $('.netmrg-check-sql').first().data('csrftoken');
            if (z) {
                var csrf = $('<input type="hidden" name="csrftoken" value="' + z + '">');
                form.append(csrf);
            }
            var ids = $('<input type="hidden" name="delids" value="' + delids.get().join(',') + '">');
            form.append(ids);
            $("body").append(form);

            form.submit();
            return false;
        }
    });


    $(function() {
        $('#selectall').click(function() {
            $('.netmrg-check-sql').prop('checked', true);
        });
        $('#selectnothing').click(function() {
            $('.netmrg-check-sql').prop('checked', false);
        });
        $('#selectinvert').click(function() {
            $('.netmrg-check-sql').click();
        });
    });
</script>

{{>settingsfooter}}
